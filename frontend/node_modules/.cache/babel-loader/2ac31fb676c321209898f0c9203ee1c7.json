{"ast":null,"code":"var _jsxFileName = \"/Users/shs/Desktop/chatting/client/src/pages/chat/container/chatting/index.jsx\";\nimport React from \"react\";\nimport { Col, Card, CardBody, Container } from \"reactstrap\";\nimport axios from \"axios\";\nimport socketio from \"socket.io-client\";\nimport ChatTitleGroup from \"../../../../components/chatTitleGroup\";\nimport ChatListGroup from \"../../../../components/chatListGroup\";\nimport ChatBtmGroup from \"../../../../components/chatBtmGroup\";\nimport \"./style.scss\";\nconst socket = socketio();\n\nclass Chatting extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.toggle = () => {\n      this.setState({\n        dropdownOpen: !this.state.dropdownOpen\n      });\n    };\n\n    this.whisperOpen = e => {} // const receiverId = e.target.innerText;\n    // this.props.propWhisper(receiverId);\n    // ****************************************************** // \n    // 전체 채팅 메시지 input 내용 변경\n    // ****************************************************** //\n    ;\n\n    this.messageChange = e => {\n      this.setState({\n        message: e.target.value\n      });\n    };\n\n    this.enterSend = e => {\n      if (e.keyCode === 13) {\n        if (!e.shiftKey) {\n          e.preventDefault();\n          this.send();\n        }\n      }\n    };\n\n    this.send = () => {\n      if (!this.state.message) {\n        alert(\"메시지를 입력하세요.\");\n      } else {\n        const sendInfo = {\n          msg: this.state.message,\n          id: this.state.userId,\n          channel: this.state.channel\n        }; // 전체 채널 메시지 저장\n\n        axios.post('/api/chats/send', {\n          msg: this.state.message,\n          id: this.state.userId,\n          channel: this.state.channel\n        }).then(({\n          data\n        }) => {\n          // 모든 사람에게 메시지 전송\n          io.emit('receive', {\n            chat: sendInfo\n          });\n        }).catch(err => {\n          console.log(err);\n        });\n        this.setState({\n          message: ''\n        });\n      }\n    };\n\n    this.state = {\n      message: '',\n      // 전송할 메시지(전체 채팅)\n      chatList: [],\n      // 메시지 리스트(전체 채팅)\n      userId: '',\n      // 유저 아이디\n      channel: 'channel',\n      // 채널(전체 채팅)\n      userList: [],\n      // 접속한 유저 리스트\n      dropdownOpen: false // 접속자 리스트 버튼\n\n    };\n  }\n\n  componentDidMount() {\n    // 유저 아이디 정보 얻기\n    axios.get('/api/users/id').then(({\n      data\n    }) => {\n      if (data) {\n        this.setState({\n          userId: data\n        });\n      } else {\n        window.location.href = \"/\";\n      } // this.props.propId(data);\n\n\n      socket.emit('channel', this.state.userId); // 전체 사용자 정보 얻기\n\n      socket.on('receiveUserList', data => {\n        this.setState({\n          userList: data\n        });\n      });\n    }); // 모든 사람들의 메시지 얻기\n\n    axios.get('/api/chats/messages', {\n      params: {\n        channel: \"channel\"\n      }\n    }).then(({\n      data\n    }) => {\n      // 본인에게 (모든 사람들의 메시지 전송)\n      // 메시지를 한꺼번에 전송해도 되지 않나?\n      this.setState({\n        chatList: data\n      });\n      const scroll = this.scroll;\n      scroll.scrollTop = scroll.scrollHeight;\n    }).catch(err => {\n      console.log(err);\n    });\n  } // ****************************************************** // \n  // 사용자 인원 클릭\n  // ****************************************************** //\n\n\n  render() {\n    const {\n      chatList,\n      userList\n    } = this.state;\n    console.log(chatList);\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(Container, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(Col, {\n      xs: {\n        size: 10,\n        offset: 1\n      },\n      sm: {\n        size: 10,\n        offset: 1\n      },\n      md: {\n        size: 6,\n        offset: 3\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, React.createElement(Card, {\n      className: \"chat\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(CardBody, {\n      className: \"chatTitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(ChatTitleGroup, {\n      userList: userList,\n      dropdownOpen: this.state.dropdownOpen,\n      toggle: this.toggle,\n      whisperOpen: this.whisperOpen,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    })), React.createElement(CardBody, {\n      className: \"chatBody\",\n      ref: ref => {\n        this.scroll = ref;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, React.createElement(ChatListGroup, {\n      chatList: chatList,\n      whisperOpen: this.whisperOpen,\n      userId: this.state.userId,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    })), React.createElement(CardBody, {\n      className: \"chatBtm\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(ChatBtmGroup, {\n      messageChange: this.messageChange,\n      enterSend: this.enterSend,\n      message: this.state.message,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }))))));\n  }\n\n}\n\nexport default Chatting;","map":{"version":3,"sources":["/Users/shs/Desktop/chatting/client/src/pages/chat/container/chatting/index.jsx"],"names":["React","Col","Card","CardBody","Container","axios","socketio","ChatTitleGroup","ChatListGroup","ChatBtmGroup","socket","Chatting","Component","constructor","props","toggle","setState","dropdownOpen","state","whisperOpen","e","messageChange","message","target","value","enterSend","keyCode","shiftKey","preventDefault","send","alert","sendInfo","msg","id","userId","channel","post","then","data","io","emit","chat","catch","err","console","log","chatList","userList","componentDidMount","get","window","location","href","on","params","scroll","scrollTop","scrollHeight","render","size","offset","ref"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,GAAT,EAAcC,IAAd,EAAoBC,QAApB,EAA8BC,SAA9B,QAA+C,YAA/C;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,kBAArB;AACA,OAAOC,cAAP,MAA2B,uCAA3B;AACA,OAAOC,aAAP,MAA0B,sCAA1B;AACA,OAAOC,YAAP,MAAyB,qCAAzB;AACA,OAAO,cAAP;AAEA,MAAMC,MAAM,GAAGJ,QAAQ,EAAvB;;AAEA,MAAMK,QAAN,SAAuBX,KAAK,CAACY,SAA7B,CAAuC;AACtCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AAClB,UAAMA,KAAN;;AADkB,SAkDnBC,MAlDmB,GAkDV,MAAM;AACd,WAAKC,QAAL,CAAc;AAACC,QAAAA,YAAY,EAAG,CAAC,KAAKC,KAAL,CAAWD;AAA5B,OAAd;AACA,KApDkB;;AAAA,SAyDnBE,WAzDmB,GAyDJC,CAAD,IAAO,CAIpB,CAJa,CACb;AAEA;AAGD;AACA;AACA;AAjEmB;;AAAA,SAkEnBC,aAlEmB,GAkEFD,CAAD,IAAO;AACtB,WAAKJ,QAAL,CAAc;AAAEM,QAAAA,OAAO,EAAGF,CAAC,CAACG,MAAF,CAASC;AAArB,OAAd;AACA,KApEkB;;AAAA,SAyEnBC,SAzEmB,GAyENL,CAAD,IAAO;AACZ,UAAGA,CAAC,CAACM,OAAF,KAAc,EAAjB,EAAqB;AAC1B,YAAI,CAACN,CAAC,CAACO,QAAP,EAAgB;AACNP,UAAAA,CAAC,CAACQ,cAAF;AACA,eAAKC,IAAL;AACT;AACK;AACJ,KAhFe;;AAAA,SAqFnBA,IArFmB,GAqFZ,MAAM;AACZ,UAAG,CAAC,KAAKX,KAAL,CAAWI,OAAf,EAAuB;AACtBQ,QAAAA,KAAK,CAAC,aAAD,CAAL;AACA,OAFD,MAGI;AACH,cAAMC,QAAQ,GAAG;AAAEC,UAAAA,GAAG,EAAG,KAAKd,KAAL,CAAWI,OAAnB;AAA4BW,UAAAA,EAAE,EAAG,KAAKf,KAAL,CAAWgB,MAA5C;AAAoDC,UAAAA,OAAO,EAAG,KAAKjB,KAAL,CAAWiB;AAAzE,SAAjB,CADG,CAEH;;AACA9B,QAAAA,KAAK,CAAC+B,IAAN,CAAW,iBAAX,EAA8B;AAAEJ,UAAAA,GAAG,EAAG,KAAKd,KAAL,CAAWI,OAAnB;AAA4BW,UAAAA,EAAE,EAAG,KAAKf,KAAL,CAAWgB,MAA5C;AAAoDC,UAAAA,OAAO,EAAG,KAAKjB,KAAL,CAAWiB;AAAzE,SAA9B,EACCE,IADD,CACM,CAAC;AAAEC,UAAAA;AAAF,SAAD,KAAc;AACnB;AACAC,UAAAA,EAAE,CAACC,IAAH,CAAQ,SAAR,EAAmB;AAAEC,YAAAA,IAAI,EAAGV;AAAT,WAAnB;AACA,SAJD,EAKCW,KALD,CAKOC,GAAG,IAAI;AACbC,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACA,SAPD;AASA,aAAK3B,QAAL,CAAc;AAAEM,UAAAA,OAAO,EAAG;AAAZ,SAAd;AACA;AACD,KAvGkB;;AAElB,SAAKJ,KAAL,GAAa;AACZI,MAAAA,OAAO,EAAG,EADE;AACI;AAChBwB,MAAAA,QAAQ,EAAG,EAFC;AAEK;AACjBZ,MAAAA,MAAM,EAAG,EAHG;AAGG;AACfC,MAAAA,OAAO,EAAG,SAJE;AAIS;AACrBY,MAAAA,QAAQ,EAAG,EALC;AAKK;AACjB9B,MAAAA,YAAY,EAAG,KANH,CAMS;;AANT,KAAb;AAQA;;AAED+B,EAAAA,iBAAiB,GAAE;AAClB;AACA3C,IAAAA,KAAK,CAAC4C,GAAN,CAAU,eAAV,EACCZ,IADD,CACM,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAc;AACnB,UAAGA,IAAH,EAAQ;AACK,aAAKtB,QAAL,CAAc;AAAEkB,UAAAA,MAAM,EAAGI;AAAX,SAAd;AACH,OAFV,MAGa;AACAY,QAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACH,OANS,CAQnB;;;AACA1C,MAAAA,MAAM,CAAC8B,IAAP,CAAY,SAAZ,EAAuB,KAAKtB,KAAL,CAAWgB,MAAlC,EATmB,CAWnB;;AACAxB,MAAAA,MAAM,CAAC2C,EAAP,CAAU,iBAAV,EAA8Bf,IAAD,IAAU;AACtC,aAAKtB,QAAL,CAAc;AAAE+B,UAAAA,QAAQ,EAAGT;AAAb,SAAd;AACA,OAFD;AAGA,KAhBD,EAFkB,CAoBlB;;AACAjC,IAAAA,KAAK,CAAC4C,GAAN,CAAU,qBAAV,EAAiC;AAACK,MAAAA,MAAM,EAAG;AAACnB,QAAAA,OAAO,EAAG;AAAX;AAAV,KAAjC,EACCE,IADD,CACM,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAc;AAClB;AACA;AACD,WAAKtB,QAAL,CAAc;AAAE8B,QAAAA,QAAQ,EAAGR;AAAb,OAAd;AAEA,YAAMiB,MAAM,GAAG,KAAKA,MAApB;AACAA,MAAAA,MAAM,CAACC,SAAP,GAAmBD,MAAM,CAACE,YAA1B;AACA,KARD,EASCf,KATD,CASOC,GAAG,IAAI;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KAXD;AAYA,GA9CqC,CAgDtC;AACA;AACA;;;AAwDAe,EAAAA,MAAM,GAAG;AACR,UAAM;AAAEZ,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,QAAyB,KAAK7B,KAApC;AACA0B,IAAAA,OAAO,CAACC,GAAR,CAAYC,QAAZ;AACA,WACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,GAAD;AAAK,MAAA,EAAE,EAAE;AAACa,QAAAA,IAAI,EAAG,EAAR;AAAYC,QAAAA,MAAM,EAAG;AAArB,OAAT;AAAkC,MAAA,EAAE,EAAE;AAACD,QAAAA,IAAI,EAAG,EAAR;AAAYC,QAAAA,MAAM,EAAG;AAArB,OAAtC;AAA+D,MAAA,EAAE,EAAE;AAAED,QAAAA,IAAI,EAAE,CAAR;AAAWC,QAAAA,MAAM,EAAE;AAAnB,OAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,IAAD;AAAM,MAAA,SAAS,EAAC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,QAAD;AAAU,MAAA,SAAS,EAAC,WAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,cAAD;AAAgB,MAAA,QAAQ,EAAEb,QAA1B;AAAoC,MAAA,YAAY,EAAE,KAAK7B,KAAL,CAAWD,YAA7D;AAA2E,MAAA,MAAM,EAAE,KAAKF,MAAxF;AAAgG,MAAA,WAAW,EAAE,KAAKI,WAAlH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,CADD,EAIC,oBAAC,QAAD;AAAU,MAAA,SAAS,EAAC,UAApB;AAA+B,MAAA,GAAG,EAAE0C,GAAG,IAAI;AAAE,aAAKN,MAAL,GAAcM,GAAd;AAAoB,OAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,aAAD;AAAe,MAAA,QAAQ,EAAEf,QAAzB;AAAmC,MAAA,WAAW,EAAE,KAAK3B,WAArD;AAAkE,MAAA,MAAM,EAAE,KAAKD,KAAL,CAAWgB,MAArF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,CAJD,EAOC,oBAAC,QAAD;AAAU,MAAA,SAAS,EAAC,SAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,YAAD;AAAc,MAAA,aAAa,EAAE,KAAKb,aAAlC;AAAiD,MAAA,SAAS,EAAE,KAAKI,SAAjE;AAA4E,MAAA,OAAO,EAAE,KAAKP,KAAL,CAAWI,OAAhG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,CAPD,CADD,CADD,CADD,CADD;AAmBA;;AAhIqC;;AAmIvC,eAAeX,QAAf","sourcesContent":["import React from \"react\";\nimport { Col, Card, CardBody, Container } from \"reactstrap\";\nimport axios from \"axios\";\nimport socketio from \"socket.io-client\";\nimport ChatTitleGroup from \"../../../../components/chatTitleGroup\";\nimport ChatListGroup from \"../../../../components/chatListGroup\";\nimport ChatBtmGroup from \"../../../../components/chatBtmGroup\";\nimport \"./style.scss\";\n\nconst socket = socketio();\n\nclass Chatting extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tmessage : '',\t\t\t// 전송할 메시지(전체 채팅)\n\t\t\tchatList : [],\t\t\t// 메시지 리스트(전체 채팅)\n\t\t\tuserId : '',\t\t\t// 유저 아이디\n\t\t\tchannel : 'channel',\t// 채널(전체 채팅)\n\t\t\tuserList : [],\t\t\t// 접속한 유저 리스트\n\t\t\tdropdownOpen : false\t// 접속자 리스트 버튼\n\t\t}\n\t}\n\t\n\tcomponentDidMount(){\n\t\t// 유저 아이디 정보 얻기\n\t\taxios.get('/api/users/id')\n\t\t.then(({ data }) => {\n\t\t\tif(data){\n                this.setState({ userId : data });\n            }\n            else{\n                window.location.href = \"/\";\n            }\n\t\t\t\n\t\t\t// this.props.propId(data);\n\t\t\tsocket.emit('channel', this.state.userId);\n\n\t\t\t// 전체 사용자 정보 얻기\n\t\t\tsocket.on('receiveUserList', (data) => {\n\t\t\t\tthis.setState({ userList : data });\n\t\t\t});\n\t\t});\n\n\t\t// 모든 사람들의 메시지 얻기\n\t\taxios.get('/api/chats/messages', {params : {channel : \"channel\"} })\n\t\t.then(({ data }) => {\n\t\t \t// 본인에게 (모든 사람들의 메시지 전송)\n\t\t \t// 메시지를 한꺼번에 전송해도 되지 않나?\n\t\t\tthis.setState({ chatList : data });\n\t\t\t \n\t\t\tconst scroll = this.scroll;\n\t\t\tscroll.scrollTop = scroll.scrollHeight;\n\t\t})\n\t\t.catch(err => {\n\t\t  console.log(err);\n\t\t});\n\t}\n\n\t// ****************************************************** // \n\t// 사용자 인원 클릭\n\t// ****************************************************** //\n\ttoggle = () => {\n\t\tthis.setState({dropdownOpen : !this.state.dropdownOpen});\n\t}\n\t\n\t// ****************************************************** // \n\t// 귓속말 대화창 열기\n\t// ****************************************************** //\n\twhisperOpen = (e) => {\n\t\t// const receiverId = e.target.innerText;\n\t\t\n\t\t// this.props.propWhisper(receiverId);\n\t}\n\t\n\t// ****************************************************** // \n\t// 전체 채팅 메시지 input 내용 변경\n\t// ****************************************************** //\n\tmessageChange = (e) => {\n\t\tthis.setState({ message : e.target.value });\n\t}\n\n\t// ****************************************************** // \n\t// 전체 채팅 메시지 input 엔터키\n\t// ****************************************************** //\n\tenterSend = (e) => {\n        if(e.keyCode === 13) {\n\t\t\tif (!e.shiftKey){\n            \te.preventDefault();\n            \tthis.send();\n\t\t\t}\n        }\n    }\n\t\n\t// ****************************************************** // \n\t// 전체 채팅 메시지 전송\n\t// ****************************************************** //\n\tsend = () => {\n\t\tif(!this.state.message){\n\t\t\talert(\"메시지를 입력하세요.\");\n\t\t}\n\t\telse{\n\t\t\tconst sendInfo = { msg : this.state.message, id : this.state.userId, channel : this.state.channel };\n\t\t\t// 전체 채널 메시지 저장\n\t\t\taxios.post('/api/chats/send', { msg : this.state.message, id : this.state.userId, channel : this.state.channel })\n\t\t\t.then(({ data }) => {\n\t\t\t\t// 모든 사람에게 메시지 전송\n\t\t\t\tio.emit('receive', { chat : sendInfo });\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log(err);\n\t\t\t});\n\n\t\t\tthis.setState({ message : '' });\n\t\t}\n\t}\n\t\n\trender() {\n\t\tconst { chatList, userList } = this.state;\n\t\tconsole.log(chatList);\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<Container>\n\t\t\t\t\t<Col xs={{size : 10, offset : 1}} sm={{size : 10, offset : 1}} md={{ size: 6, offset: 3 }} >\n\t\t\t\t\t\t<Card className=\"chat\" >\n\t\t\t\t\t\t\t<CardBody className=\"chatTitle\" >\n\t\t\t\t\t\t\t\t<ChatTitleGroup userList={userList} dropdownOpen={this.state.dropdownOpen} toggle={this.toggle} whisperOpen={this.whisperOpen}/>\n\t\t\t\t\t\t\t</CardBody>\n\t\t\t\t\t\t\t<CardBody className=\"chatBody\" ref={ref => { this.scroll = ref; }}>\n\t\t\t\t\t\t\t\t<ChatListGroup chatList={chatList} whisperOpen={this.whisperOpen} userId={this.state.userId}/>\n\t\t\t\t\t\t\t</CardBody>\n\t\t\t\t\t\t\t<CardBody className=\"chatBtm\">\n\t\t\t\t\t\t\t\t<ChatBtmGroup messageChange={this.messageChange} enterSend={this.enterSend} message={this.state.message}/>\n\t\t\t\t\t\t\t</CardBody>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Col>\n\t\t\t\t</Container>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\t\nexport default Chatting;"]},"metadata":{},"sourceType":"module"}